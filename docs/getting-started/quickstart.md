# å¿«é€Ÿå¼€å§‹

## ğŸ“š ç›®å½•

- [ğŸ“ æ¡†æ¶ç¤ºä¾‹æ–‡ä»¶](#-æ¡†æ¶ç¤ºä¾‹æ–‡ä»¶)
- [âš¡ å¿«é€Ÿç¤ºä¾‹](#-å¿«é€Ÿç¤ºä¾‹)
  - [ç¬¬ 1 æ­¥ï¼šåˆ›å»ºé™æµä¸­é—´ä»¶å·¥å‚](#ç¬¬-1-æ­¥åˆ›å»ºé™æµä¸­é—´ä»¶å·¥å‚)
  - [ç¬¬ 2 æ­¥ï¼šåœ¨è·¯ç”±ä¸­ä½¿ç”¨](#ç¬¬-2-æ­¥åœ¨è·¯ç”±ä¸­ä½¿ç”¨)
- [ğŸ“ è¯´æ˜](#-è¯´æ˜)
- [ğŸ“– æ›´å¤šç¤ºä¾‹](#-æ›´å¤šç¤ºä¾‹)
- [ğŸ¯ ä¸‹ä¸€æ­¥](#-ä¸‹ä¸€æ­¥)

---

å¿«é€Ÿå¼€å§‹ç¤ºä¾‹å·²æŒ‰æ¡†æ¶æ‹†åˆ†ä¸ºå•ç‹¬æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½åŒ…å«å®Œæ•´çš„ä¸­é—´ä»¶å·¥å‚ + è·¯ç”±é…ç½®ç¤ºä¾‹ã€‚

## ğŸ“ æ¡†æ¶ç¤ºä¾‹æ–‡ä»¶

| æ¡†æ¶ | å¿«é€Ÿå¼€å§‹æ–‡ä»¶ | è¯´æ˜ |
|------|------------|------|
| **Express** | [quickstart-express.js](../examples/quickstart-express.js) | å®Œæ•´çš„Expressè·¯ç”±çº§é™æµç¤ºä¾‹ |
| **Koa** | [quickstart-koa.js](../examples/quickstart-koa.js) | å®Œæ•´çš„Koaè·¯ç”±çº§é™æµç¤ºä¾‹ |
| **Egg.js** | [quickstart-egg.js](../examples/quickstart-egg.js) | å®Œæ•´çš„Egg.jsè·¯ç”±çº§é™æµç¤ºä¾‹ |
| **Hapi** | [quickstart-hapi.js](../examples/quickstart-hapi.js) | å®Œæ•´çš„Hapiè·¯ç”±çº§é™æµç¤ºä¾‹ |
| **ç‹¬ç«‹ä½¿ç”¨** | [standalone-example.js](../examples/standalone-example.js) | æ— æ¡†æ¶æƒ…å†µä¸‹çš„ä½¿ç”¨ |

## âš¡ å¿«é€Ÿç¤ºä¾‹

æ‰€æœ‰æ¡†æ¶éƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š

### ç¬¬ 1 æ­¥ï¼šåˆ›å»ºé™æµä¸­é—´ä»¶å·¥å‚

```javascript
const createLimiters = () => {
  return {
    // ä¸¥æ ¼é™åˆ¶ï¼š15åˆ†é’Ÿ5æ¬¡ï¼ˆç™»å½•ã€æ³¨å†Œç­‰ï¼‰
    strict: (req, res, next) => {
      const limiter = new RateLimiter({
        windowMs: 15 * 60 * 1000,
        max: 5,
      });
      limiter.middleware()(req, res, next);
    },
    
    // ä¸­ç­‰é™åˆ¶ï¼š1å°æ—¶50æ¬¡ï¼ˆæ–‡ä»¶æ“ä½œã€æ•°æ®ä¿®æ”¹ï¼‰
    normal: (req, res, next) => {
      const limiter = new RateLimiter({
        windowMs: 60 * 60 * 1000,
        max: 50,
      });
      limiter.middleware()(req, res, next);
    },
    
    // å®½æ¾é™åˆ¶ï¼š1åˆ†é’Ÿ200æ¬¡ï¼ˆæ•°æ®æŸ¥è¯¢ã€è¯»æ“ä½œï¼‰
    relaxed: (req, res, next) => {
      const limiter = new RateLimiter({
        windowMs: 60 * 1000,
        max: 200,
      });
      limiter.middleware()(req, res, next);
    },
  };
};

const limit = createLimiters();
```

### ç¬¬ 2 æ­¥ï¼šåœ¨è·¯ç”±ä¸­ç›´æ¥ä½¿ç”¨ä¸­é—´ä»¶

```javascript
// Express
app.post('/api/login', limit.strict, controller.login);
app.get('/api/users', limit.relaxed, controller.list);
app.post('/api/upload', limit.normal, controller.upload);

// Koa
router.post('/api/login', limit.strict, controller.login);
router.get('/api/users', limit.relaxed, controller.list);
router.post('/api/upload', limit.normal, controller.upload);

// Egg.js
router.post('/api/login', limit.strict, controller.auth.login);
router.get('/api/users', limit.relaxed, controller.user.list);
router.post('/api/upload', limit.normal, controller.file.upload);
```

**å°±è¿™ä¹ˆç®€å•ï¼** âœ¨

---

## ğŸ“ è®¾è®¡ç†å¿µ

### ä¸ºä»€ä¹ˆä½¿ç”¨ä¸­é—´ä»¶å·¥å‚æ¨¡å¼ï¼Ÿ

ä¼ ç»Ÿæ–¹å¼éœ€è¦åœ¨æ¯ä¸ªè·¯ç”±é…ç½® `perRoute`ï¼š

```javascript
// âŒ ä¼ ç»Ÿæ–¹å¼ï¼šåˆ†æ•£é…ç½®ï¼Œéš¾ä»¥ç»´æŠ¤
const limiter = new RateLimiter({
  windowMs: 60000,
  max: 100,
  perRoute: {
    '/api/login': { max: 5, windowMs: 15 * 60 * 1000 },
    '/api/users': { max: 200 },
    '/api/upload': { max: 10, windowMs: 60 * 60 * 1000 },
    // ... è·¯ç”±è¶Šå¤šè¶Šéš¾ç»´æŠ¤
  },
});
```

**ä¸­é—´ä»¶å·¥å‚æ¨¡å¼çš„ä¼˜åŠ¿**ï¼š

```javascript
// âœ… æ–°æ–¹å¼ï¼šè·¯ç”±å’Œé™æµé…ç½®åœ¨ä¸€èµ·
router.post('/api/login', limit.strict, controller.login);     // ä¸€çœ¼çœ‹å‡ºï¼šä¸¥æ ¼é™åˆ¶
router.get('/api/users', limit.relaxed, controller.list);      // ä¸€çœ¼çœ‹å‡ºï¼šå®½æ¾é™åˆ¶
router.post('/api/upload', limit.normal, controller.upload);   // ä¸€çœ¼çœ‹å‡ºï¼šä¸­ç­‰é™åˆ¶
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
1. âœ… **é…ç½®é›†ä¸­**ï¼šæ‰€æœ‰é™æµé…ç½®åœ¨è·¯ç”±å®šä¹‰å¤„
2. âœ… **è¯­ä¹‰æ¸…æ™°**ï¼š`strict`ã€`normal`ã€`relaxed` ä¸€ç›®äº†ç„¶
3. âœ… **æ˜“äºç»´æŠ¤**ï¼šä¿®æ”¹é™æµåªéœ€æ”¹è·¯ç”±å®šä¹‰
4. âœ… **ç»Ÿä¸€æ¨¡å¼**ï¼šæ‰€æœ‰æ¡†æ¶ä½¿ç”¨ç›¸åŒæ–¹å¼

---

## ğŸ“Š é™åˆ¶çº§åˆ«é€‰æ‹©æŒ‡å—

### å¦‚ä½•é€‰æ‹©é™åˆ¶çº§åˆ«ï¼Ÿ

| çº§åˆ« | é…ç½® | é€‚ç”¨åœºæ™¯ | åŸå›  |
|------|------|---------|------|
| **strict** | 15åˆ†é’Ÿ5æ¬¡ | ç™»å½•ã€æ³¨å†Œã€æ‰¾å›å¯†ç  | é˜²æš´åŠ›ç ´è§£ â­â­â­ |
| **normal** | 1å°æ—¶50æ¬¡ | æ–‡ä»¶ä¸Šä¼ ã€æ•°æ®ä¿®æ”¹ã€åˆ é™¤æ“ä½œ | é˜²æ»¥ç”¨ï¼Œä¿æŠ¤èµ„æº |
| **relaxed** | 1åˆ†é’Ÿ200æ¬¡ | æ•°æ®æŸ¥è¯¢ã€åˆ—è¡¨æ¥å£ã€æœç´¢ | å…è®¸æ­£å¸¸é«˜é¢‘ä½¿ç”¨ |
| **custom** | è‡ªå®šä¹‰ | ç‰¹æ®Šä¸šåŠ¡éœ€æ±‚ | çµæ´»é…ç½® |

### å®é™…å†³ç­–ç¤ºä¾‹

**åœºæ™¯1ï¼šç”¨æˆ·ç™»å½•æ¥å£**
```javascript
router.post('/api/login', limit.strict, controller.login);
// âœ… é€‰æ‹© strict
// åŸå› ï¼šç™»å½•å¤±è´¥é€šå¸¸æ˜¯æš´åŠ›ç ´è§£ï¼Œ15åˆ†é’Ÿ5æ¬¡è¶³å¤Ÿæ­£å¸¸ç”¨æˆ·
```

**åœºæ™¯2ï¼šç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢**
```javascript
router.get('/api/users/:id', limit.relaxed, controller.getUser);
// âœ… é€‰æ‹© relaxed
// åŸå› ï¼šæŸ¥è¯¢æ“ä½œï¼Œç”¨æˆ·å¯èƒ½é¢‘ç¹åˆ·æ–°ï¼Œ1åˆ†é’Ÿ200æ¬¡å¾ˆå®½æ¾
```

**åœºæ™¯3ï¼šæ–‡ä»¶ä¸Šä¼ **
```javascript
router.post('/api/upload', limit.normal, controller.upload);
// âœ… é€‰æ‹© normal
// åŸå› ï¼šä¸Šä¼ æ¶ˆè€—èµ„æºï¼Œ1å°æ—¶50æ¬¡æ—¢ä¿æŠ¤æœåŠ¡å™¨åˆä¸å½±å“æ­£å¸¸ä½¿ç”¨
```

**åœºæ™¯4ï¼šæ”¯ä»˜æ¥å£ï¼ˆç‰¹æ®Šéœ€æ±‚ï¼‰**
```javascript
router.post('/api/payment', limit.custom(60 * 60 * 1000, 10), controller.pay);
// âœ… é€‰æ‹© custom(1å°æ—¶, 10æ¬¡)
// åŸå› ï¼šæ”¯ä»˜æ¥å£éå¸¸æ•æ„Ÿï¼Œéœ€è¦æ›´ä¸¥æ ¼çš„è‡ªå®šä¹‰é™åˆ¶
```

---

## ğŸ¯ å¿«é€Ÿå†³ç­–æ ‘

```
å¼€å§‹
â”‚
â”œâ”€ æ˜¯å¦æ˜¯è®¤è¯ç›¸å…³ï¼Ÿï¼ˆç™»å½•/æ³¨å†Œ/æ‰¾å›å¯†ç ï¼‰
â”‚  â””â”€ æ˜¯ â†’ ä½¿ç”¨ strictï¼ˆ15åˆ†é’Ÿ5æ¬¡ï¼‰
â”‚
â”œâ”€ æ˜¯å¦æ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Ÿï¼ˆä¸Šä¼ /å¯¼å‡º/è®¡ç®—ï¼‰
â”‚  â””â”€ æ˜¯ â†’ ä½¿ç”¨ normalï¼ˆ1å°æ—¶50æ¬¡ï¼‰
â”‚
â”œâ”€ æ˜¯å¦æ˜¯æŸ¥è¯¢æ“ä½œï¼Ÿï¼ˆåˆ—è¡¨/è¯¦æƒ…/æœç´¢ï¼‰
â”‚  â””â”€ æ˜¯ â†’ ä½¿ç”¨ relaxedï¼ˆ1åˆ†é’Ÿ200æ¬¡ï¼‰
â”‚
â””â”€ æ˜¯å¦æœ‰ç‰¹æ®Šä¸šåŠ¡éœ€æ±‚ï¼Ÿ
   â””â”€ æ˜¯ â†’ ä½¿ç”¨ custom(windowMs, max)
```

---

## å®Œæ•´ç¤ºä¾‹è¯´æ˜

æ¯ä¸ªå¿«é€Ÿå¼€å§‹æ–‡ä»¶éƒ½åŒ…å«ï¼š

1. **ä¸­é—´ä»¶å·¥å‚å‡½æ•°** - é¢„å®šä¹‰çš„ 4 ä¸ªé™åˆ¶çº§åˆ«
   - `strict` - ä¸¥æ ¼é™åˆ¶ï¼ˆ15åˆ†é’Ÿ5æ¬¡ï¼‰
   - `normal` - ä¸­ç­‰é™åˆ¶ï¼ˆ1å°æ—¶50æ¬¡ï¼‰
   - `relaxed` - å®½æ¾é™åˆ¶ï¼ˆ1åˆ†é’Ÿ200æ¬¡ï¼‰
   - `custom(windowMs, max)` - è‡ªå®šä¹‰é™åˆ¶

2. **è·¯ç”±å®šä¹‰ç¤ºä¾‹** - å±•ç¤ºå¦‚ä½•åœ¨ä¸åŒè·¯ç”±ä¸­åº”ç”¨é™æµ
   - è®¤è¯ç›¸å…³è·¯ç”±ï¼ˆä¸¥æ ¼é™åˆ¶ï¼‰
   - ç”¨æˆ·ç›¸å…³è·¯ç”±ï¼ˆå®½æ¾é™åˆ¶ï¼‰
   - æ–‡ä»¶æ“ä½œè·¯ç”±ï¼ˆä¸­ç­‰é™åˆ¶ï¼‰
   - ç‰¹æ®Šç«¯ç‚¹ï¼ˆè‡ªå®šä¹‰é™åˆ¶ï¼‰

3. **å®Œæ•´çš„æœåŠ¡å™¨å¯åŠ¨ä»£ç ** - å¯ä»¥ç›´æ¥è¿è¡Œ

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

âœ… **æ— éœ€é‡å¤é…ç½®** - åªåœ¨è·¯ç”±ä¸­é…ç½®ï¼Œæ— éœ€ perRoute  
âœ… **æ‰€æœ‰æ¡†æ¶ç»Ÿä¸€** - Expressã€Koaã€Egg.jsã€Hapi ç›¸åŒæ¨¡å¼  
âœ… **æ¸…æ™°æ˜“ç»´æŠ¤** - è·¯ç”±å’Œé™æµé…ç½®åœ¨ä¸€èµ·  
âœ… **å¼€ç®±å³ç”¨** - å¤åˆ¶ç¤ºä¾‹ä»£ç ç›´æ¥ä½¿ç”¨  

## ğŸƒ å¿«é€Ÿè¿è¡Œç¤ºä¾‹

```bash
# Express å¿«é€Ÿå¼€å§‹
node examples/quickstart-express.js

# Koa å¿«é€Ÿå¼€å§‹
node examples/quickstart-koa.js

# Egg.js å¿«é€Ÿå¼€å§‹
node examples/quickstart-egg.js

# Hapi å¿«é€Ÿå¼€å§‹
node examples/quickstart-hapi.js
```

## ğŸ“š æ·±å…¥äº†è§£

- æ›´å¤šé…ç½®é€‰é¡¹ï¼ŒæŸ¥çœ‹ [é…ç½®è¯¦è§£](./config.md)
- é«˜çº§ç”¨æ³•ï¼ŒæŸ¥çœ‹ [é«˜çº§ç”¨æ³•](./advanced.md)
- é™æµç®—æ³•ï¼ŒæŸ¥çœ‹ [ç®—æ³•å¯¹æ¯”æŒ‡å—](./algorithms-comparison.md)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

**ä¸‹ä¸€æ­¥é˜…è¯»**ï¼š
- ğŸ“– [é…ç½®è¯¦è§£](./config.md) - äº†è§£æ‰€æœ‰é…ç½®é€‰é¡¹å’Œæ¨èé…ç½®
- ğŸ“– [é«˜çº§ç”¨æ³•](./advanced.md) - å­¦ä¹ è·¯ç”±çº§é™æµå’ŒåŠ¨æ€é…ç½®

**ç›¸å…³ä¸»é¢˜**ï¼š
- ğŸ“– [ä¸šåŠ¡é”æŒ‡å—](./business-lock-guide.md) - æŒ‰ç”¨æˆ·+è·¯ç”±çš„ç²¾ç»†åŒ–é™æµ
- ğŸ“– [ç®—æ³•å¯¹æ¯”æŒ‡å—](./algorithms-comparison.md) - é€‰æ‹©åˆé€‚çš„é™æµç®—æ³•
- ğŸ“– [å­˜å‚¨åç«¯](./storage.md) - Memory vs Redisé€‰æ‹©

**è¿”å›**ï¼š
- ğŸ“– [æ–‡æ¡£ä¸­å¿ƒ](./README.md) - æŸ¥çœ‹æ‰€æœ‰æ–‡æ¡£å’Œå­¦ä¹ è·¯å¾„
